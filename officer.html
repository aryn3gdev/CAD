<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ERLC CAD - Officer</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans flex flex-col items-center p-4">

<div class="w-full max-w-4xl">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold text-blue-700">Officer Dashboard</h1>
    <div>
      <span id="discord-info" class="mr-4 font-medium"></span>
      <select id="settings-dropdown" class="border rounded p-1">
        <option value="changeCallsign">Change Callsign</option>
        <option value="switchRole">Switch Role</option>
      </select>
    </div>
  </div>

  <!-- 10-code buttons -->
  <div class="flex flex-wrap gap-2 mb-4">
    <button onclick="updateStatus('10-8')" class="bg-green-600 text-white p-2 rounded">10-8</button>
    <button onclick="updateStatus('10-7')" class="bg-gray-600 text-white p-2 rounded">10-7</button>
    <button onclick="updateStatus('10-11')" class="bg-yellow-500 text-white p-2 rounded">10-11</button>
    <button onclick="updateStatus('10-99')" class="bg-red-600 text-white p-2 rounded">10-99</button>
    <button onclick="updateStatus('10-80')" class="bg-orange-500 text-white p-2 rounded">10-80</button>
    <!-- Dropdown for extra codes -->
    <select id="extra-codes" onchange="updateStatus(this.value)" class="border rounded p-2">
      <option value="">Other Codes</option>
      <!-- Add more codes here -->
      <option value="10-50">10-50</option>
      <option value="10-60">10-60</option>
    </select>
  </div>

  <div id="status-message" class="text-red-500 font-semibold mb-4"></div>
</div>

<script>
const ws = new WebSocket("wss://cad-backend-0ivi.onrender.com");

// Check login
const token = localStorage.getItem("token");
const role = localStorage.getItem("role");
if (!token || !role || role === "dispatch") {
  window.location.href = "index.html";
}

// Setup callsign
let callsign = localStorage.getItem("callsign");
if (!callsign) {
  callsign = prompt("Enter your callsign:");
  localStorage.setItem("callsign", callsign);
}

// Show Discord info
document.getElementById("discord-info").innerText =
  `${localStorage.getItem("discordName")} (${localStorage.getItem("discordID")})`;

// WebSocket logic
ws.addEventListener("open", () => {
  console.log("Connected to CAD WebSocket");
  // Register officer
  ws.send(JSON.stringify({
    type: "register",
    callsign,
    status: "10-8",
    discordName: localStorage.getItem("discordName"),
    discordID: localStorage.getItem("discordID")
  }));
});

// Update officer status
function updateStatus(newStatus) {
  if (!newStatus) return;
  ws.send(JSON.stringify({
    type: "statusUpdate",
    callsign,
    status: newStatus,
    discordName: localStorage.getItem("discordName"),
    discordID: localStorage.getItem("discordID")
  }));
  document.getElementById("status-message").innerText = `Status updated to ${newStatus}`;
}

// Settings dropdown
document.getElementById("settings-dropdown").addEventListener("change", (e) => {
  const val = e.target.value;
  if (val === "changeCallsign") {
    const newCallsign = prompt("Enter new callsign:");
    if (newCallsign) {
      callsign = newCallsign;
      localStorage.setItem("callsign", callsign);
      updateStatus("10-8"); // re-register
    }
  } else if (val === "switchRole") {
    localStorage.removeItem("role");
    localStorage.removeItem("token");
    window.location.href = "index.html";
  }
});
</script>
</body>
</html>
