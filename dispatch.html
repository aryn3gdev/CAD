<!DOCTYPE html>
<html>
<head>
  <title>Dispatch Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; background: #111; color: white; padding: 20px; }
    h1 { color: #FF5555; }
    #units, #logs { margin-top: 20px; padding: 10px; background: #222; border-radius: 5px; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>

<h1>Dispatch Dashboard</h1>

<div id="units">
  <strong>Live Units:</strong>
  <div id="unit-list"></div>
</div>

<div id="logs">
  <strong>Activity Logs:</strong>
  <div id="log-list"></div>
</div>

<script>
  const backend = "https://YOUR-RENDER-URL.onrender.com";

  // Protect page
  const role = localStorage.getItem("role");
  const token = localStorage.getItem("token");
  if (!token || role !== "dispatch") window.location.href = "index.html";

  const unitList = document.getElementById("unit-list");
  const logList = document.getElementById("log-list");

  async function update() {
    try {
      const units = await (await fetch(`${backend}/units`)).json();
      const logs = await (await fetch(`${backend}/logs`)).json();

      unitList.innerHTML = "";
      units.forEach(u => { unitList.innerHTML += `<div>${u.callsign} — ${u.status}</div>`; });

      logList.innerHTML = "";
      logs.forEach(l => { logList.innerHTML += `<div>${new Date(l.time).toLocaleTimeString()} — ${l.message}</div>`; });

    } catch (err) { console.error(err); }
  }

  // Refresh every 3 seconds
  setInterval(update, 3000);
  update();
</script>

</body>
</html>
